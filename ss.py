


# üì¶ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
import streamlit as st          # –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
import pandas as pd             # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏
from cbr_parser import load_cbr_data  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç —Å —Å–∞–π—Ç–∞ –¶–ë

# üß≠ –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("üí± –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç (–¶–ë –†–§)")

# üß© 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–∞ –¶–ë
try:
    df = load_cbr_data()                      # –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –¥—Ä—É–≥–æ–≥–æ –º–æ–¥—É–ª—è
    st.success("–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!")  # –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
except Exception as e:
    st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö: {e}")  # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë
    st.stop()                                     # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

# üìä 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å –∫—É—Ä—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
st.dataframe(df)  # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–µ—Å—å DataFrame –ø—Ä—è–º–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Streamlit

# üí± 3. –°–æ–∑–¥–∞—ë–º –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏ –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç
currencies = df["–ë—É–∫–≤. –∫–æ–¥"].tolist()   # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞–ª—é—Ç
from_currency = st.selectbox(           # –í—ã–±–æ—Ä –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã
    "–ò–∑ –≤–∞–ª—é—Ç—ã:", 
    currencies, 
    index=currencies.index("USD")       # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –¥–æ–ª–ª–∞—Ä
)
to_currency = st.selectbox(             # –í—ã–±–æ—Ä —Ü–µ–ª–µ–≤–æ–π –≤–∞–ª—é—Ç—ã
    "–í –≤–∞–ª—é—Ç—É:", 
    currencies, 
    index=currencies.index("RUB")       # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Ä—É–±–ª—å
)

# üí∞ 4. –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ —Å—É–º–º—ã
amount = st.number_input(
    "–°—É–º–º–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:",  # –ü–æ–¥–ø–∏—Å—å –∫ –ø–æ–ª—é
    min_value=0.0,              # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    value=100.0,                # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    step=1.0                    # –®–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è
)

# üßÆ 5. –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
if st.button("–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"):
    try:
        # –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç —Å —É—á—ë—Ç–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –µ–¥–∏–Ω–∏—Ü
        from_rate = df.loc[df["–ë—É–∫–≤. –∫–æ–¥"] == from_currency, "–ö—É—Ä—Å"].values[0] / \
                    df.loc[df["–ë—É–∫–≤. –∫–æ–¥"] == from_currency, "–ï–¥–∏–Ω–∏—Ü"].values[0]
        to_rate = df.loc[df["–ë—É–∫–≤. –∫–æ–¥"] == to_currency, "–ö—É—Ä—Å"].values[0] / \
                  df.loc[df["–ë—É–∫–≤. –∫–æ–¥"] == to_currency, "–ï–¥–∏–Ω–∏—Ü"].values[0]

        # –í—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–µ—Å—á—ë—Ç
        result = amount * (from_rate / to_rate)

        # ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        st.success(f"{amount} {from_currency} = {result:.2f} {to_currency}")

    except Exception as e:
        # ‚ö†Ô∏è –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: {e}")
